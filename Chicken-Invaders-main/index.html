<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="gamestyle.css" type="text/css">
    <link rel="stylesheet" href="menu.css" type="text/css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="space.js" defer></script>
    <script type="text/javascript" src="spaceship.js"></script>
    <script type="text/javascript" src="enemeis.js"></script>
    <script type="text/javascript" src="menu.js"></script>
    
    
    <title>Chicken Invaders</title>
</head>
<body>
    <canvas id="space"></canvas>
    <audio id = "spaceshipExplosion" preload = "auto">
        <source src = "explosion.wav" type = "audio/mpeg"></audio>
     <audio id = "spaceshipShoot" preload = "auto">
        <source src = "shoot.wav" type = "audio/mpeg"></audio>
     <audio id = "enemyKilled" preload = "auto">
        <source src = "invaderkilled.wav" type = "audio/mpeg"></audio>
        <audio id = "enemyHit" preload = "auto">
            <source src = "fastinvader3.wav" type = "audio/mpeg"></audio>
    

    <div id="container">
        
    <div id="header">
        <div class="header-section">Logo</div>
        <div class="header-section">Chicken Invaders</div>
        <div class="header-section">Hello</div>
        <!-- <button id="menu-toggle" type="button" onclick="menuToggle(true)" class="card toggle-bt">Main menu</button>
        <button id="sign-in" type="button" onclick="signInToggle()" class="card toggle-bt">Register</button>
        <button id="login" type="button" onclick="loginToggle()" class="card toggle-bt">Login</button> -->
    </div>

    <div id="content">
    <div id="login-screen">
        <h1 style="color:white; top: -55%; left: 35%;">Login</h1>
        <form id="login">
            <label id="login-msg"></label>
            <label>Username: </label>
            <input type="text" class="input-space" id="connect-username">
            <label>Password: </label>
            <input type="password" class="input-space" id="connect-password">
            <input type="button" style="position: relative; font-size: 20px;" class="card"  value="Connect" onclick="Connect()">
            <input type="button" style="position: relative; font-size: 20px;" class="card" value="Register"  onclick="signInToggle();loginToggle()">
        </form>
    </div>

    <div id="configure" style="display: none;">

         <label for="fire-input">Fire Key</label>
            <input type="text" id="fire-input"  class="input-space" id="fireButton-input"  value="Space" >

            <label for="timer-setup">Round Time</label>
            <select class="card" style="width:max-content; height: max-content;" id="timer-setup">
                <option>2:00</option>
                <option>2:30</option>
                <option>3:00</option>
                <option>3:30</option>
                <option>4:00</option>
                <option>4:30</option>
                <option>5:00</option>
            </select>
        <label for="spaceship-color">Spaceship color</label>
            <select class="card" style="width:max-content; height: max-content;" id="spaceship-color">
                <option style="background-color: orange;">Orange</option>
                <option style="background-color: blue;">Blue</option>
                <option style="background-color: green;;">Green</option>
                <option style="background-color: yellow;">Yellow</option>
                <option style="background-color: red;;">Red</option>
            </select>
        <input type="button" class="card" onclick="configure()" value="Apply selection" style="font-size:20px">
    </div>
    
    <div id="sign-in-screen" style="display: none;">
        <form id="sign-in">
            <label id="username-label">Username: </label>
            <input type="text" class="input-space" id="username-input">
            <label id="password1-label">Password:</label>
            <input type="password" class="input-space" id="password1-input">
            <label id="password2-label">Verify Password:</label>
            <input type="password" class="input-space" id="password2-input">
            <label id="first-name-label">First Name: </label>
            <input type="text" class="input-space" id="first-name-input">
            <label id="last-name-label">Last Name: </label>
            <input type="text" class="input-space" id="last-name-input">
            <label id="email-label">Last Name: </label>
            <input type="text" class="input-space" id="email-input">
            <label>Birthdate:</label>
            <input autocomplete="off" class="text" id="MoveInDate" name="MoveInDate" placeholder="DD-MM-YYYY" type="date" spellcheck="false">
            <input type="button" class="card" onclick="Register()" value="Register">
            <button type="button" class="card" onclick="backLoginScreen()">Back</button>
        </form>
    </div>


    <div id="main-menu" style="display: none;">
        <h1 id="title-ci">
            <span class="magic">
                <span class="magic-text">
                    Chicken<br>&nbsp &nbsp &nbsp Invaders
                </span>
            </span>
            </h1>
        <div id="menu">
            <div class="card" id="start-game-bt" onclick="startGame()">Start Game</div>
            <div class="card" id="options-bt" onclick="configureToggle();menuToggle(false);">Options</div>
            <div class="card" id="about-bt" onclick="aboutToggle()">About</div>
            <div class="card" id="scoreboard-bt" onclick="scoreboardToggle()">Scoreboard</div>
        </div>
    </div>
        
    <div id="about-modal" class="modal" style="display: none;">
        <div id="about" class="modal-content">
            <span id="about-exit" onclick="aboutToggle()">X</span>
            <h1>About</h1>
            <p>
                Hello our name is Eden & Shelly<br>
                We've created this game for universty project<br>
                Developing In network enivroments.
            </p>
        </div>
    </div>

    <div id="scoreboard" class="modal" style="display: none;">
        <div class="modal-content">
            <table id="scoreboard-tb">
                <th>Username</th>
                <th>Score</th>
                <th>Time</th>
                <th>Life</th>
            </table>
        </div>
    </div>
    </div>
    
    <div id="footer">
        <div>content1</div>
        <div>content2</div>
        <div>content3 Hello world</div>
    </div>
    </div>

    <div id="game" style="display: none;">
        <div id="score">Score:</div>
        <div id="health">ðŸš€ðŸš€ðŸš€</div>
        <div id="timer"></div>
        <button id="play" onclick="pauseOrplay()">Play</button>  
    </div>

</body>
<script>
    var intervalTimer;
    var intervalGameEvents;
    var intervalTimer;
    
    var roundTimer = 2*60*1000;
    var timerDisplay;

    var aboutModal;
    var scoreboard = [];
    var scoreboardDisplay;

    var enemyExplodeSound;
    var spaceshipExplodeSound;
    var spaceshipShootSound;
    var enemyHitSound;

    var brigade = []

    const accounts = [{username: "p",password: 'testuser'}];
    localStorage.setItem("Accounts", JSON.stringify(accounts));

    
    $(document).ready(function() {
        menuSpaceOn();
        timerDisplay = document.getElementById("timer");
        aboutModal = document.getElementById("about-modal");
        scoreboardDisplay = document.getElementById("scoreboard");


        enemyExplodeSound = document.getElementById("enemyKilled");
        spaceshipExplodeSound = document.getElementById("spaceshipExplosion");
        spaceshipShootSound = document.getElementById("spaceshipShoot");
        enemyHitSound = document.getElementById("enemyHit");
    })

    window.onclick = (event) => {
        if(event.target == aboutModal){
            aboutToggle();
        }

        if(event.target == scoreboardDisplay){
            scoreboardToggle();
        }
    }


    function menuSpaceOn(){

        if(intervalTimer){
            clearInterval(intervalTimer)
        }
        intervalTimer = setInterval(() => {
            contextSpace.clearRect(0, 0, space.width, space.height);
            updateStarPosition();
        }, 3);
    }

    function setTimer(timeString){
        let timeValue = timeString.split('\:');
        let minutes = parseInt(timeValue[0]);
        let seconds = parseInt(timeValue[1]);

        roundTimer = minutes*60*1000 + seconds*1000;
    }

    function menuSpaceOff(){
        clearInterval(intervalTimer);      
    }

    function startGame(){
        var content = document.getElementById("container").style.display = "none";
        var game = document.getElementById("game").style.display = "";
        var brigade = createBrigade(4, 5);
        menuSpaceOff();
        pauseOrplay();
    }

    function endGame(){
        pauseOrplay();
        menuSpaceOn();

        addToScoreboard();
        generateScoreboard();
        scoreboardToggle();

        var game = document.getElementById("game").style.display = "none";   
        var content = document.getElementById("container").style.display = "";

    }

    function addRowToScoreboardTable(username, score, time, health, place){    
        var username_td = document.createTextNode(username)  
        var score_td = document.createTextNode(score);
        var health_td = document.createTextNode(time);
        var time_td = document.createTextNode(health);

        var scoreboard_b = scoreboardDisplay.getElementsByTagName('tbody')[0];
        var scoreboard_row = scoreboard_b.insertRow();

        var username_cell = scoreboard_row.insertCell();
        var score_cell = scoreboard_row.insertCell();
        var health_cell = scoreboard_row.insertCell();
        var time_cell = scoreboard_row.insertCell();

        username_cell.appendChild(username_td);
        score_cell.appendChild(score_td);
        health_cell.appendChild(health_td);
        time_cell.appendChild(time_td);

        if(place == scoreboard.length){
            scoreboard_row.style.background = "rgb(208, 218, 225)";
            scoreboard_row.style.color = "black";
        }
    }


    function generateScoreboard(){
        $('#scoreboard-tb tr:not(:first)').remove();

        scoreboard.forEach(row => {
            addRowToScoreboardTable(row[0], row[1], row[2], row[3], row[4]);
        });
    }


    function addToScoreboard(){
        var username = "Eden" // understand how to store the current logged user.
        var health_td = healthTag.innerHTML;
        var score_td = scoreTag.innerHTML;
        var time_td = timerDisplay.innerHTML;

        scoreboard.push([username, health_td, score_td, time_td, scoreboard.length+1]);
        scoreboard.sort((a,b) => {
            return b[2].localeCompare(a[2]);
        });
    }

    function pauseOrplay(){
        const play = document.getElementById("play");
        setSpaceship();
        enemyBullet = {x: space.width / 2, y: space.height};


        if(!gameState){
            createStars(10);
            var increaseCount = 0;
            var timePassed = 0;

            intervalGameEvents = setInterval(() => {

                contextSpace.clearRect(0, 0, space.width, space.height);
                updateStarPosition();
                updateBrigade();
                updateTrailPosition();
                updateFirePositions();
                updateEnemyFirePositions();
                updateSpaceshipPositions();

                timePassed++;

                if(increaseCount < 4 && timePassed % 5000 == 0){
                    increaseSpeed(1.07);
                    increaseCount++;
                }
            }, 1);

       
            play.innerHTML = "Pause";

            var time = roundTimer;
            intervalTimer = setInterval(() => {
                var minutes = Math.floor(time / (1000*60)).toString().padStart(2, 0);
                var seconds = Math.floor((time % (60*1000)/ 1000)).toString().padStart(2, 0);

                timerDisplay.innerHTML = `${minutes}:${seconds}`;
                time = time - 1000;

                if( time == 0){
                    alert("Game Over");
                }
            }, 1000);

            gameState = true;

        }else{
            clearInterval(intervalTimer);
            clearInterval(intervalGameEvents)

            play.innerHTML = "Play";
            gameState = false;
        }  
    }

    function reset(){
        createBrigade();

        score = 0;
        scoreTag.textContent = `Score: ${score}`;
        shoots = [];
        enemyShots = [];
        spaceship = {x: space.width / 2, y: space.height - spaceship_height*3}
        enemyBullet = {x: space.width / 2, y: space.height};
        healthTag.textContent = 'ðŸš€'.repeat(healthBar);
    }

</script>

</html>