<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="gamestyle.css" type="text/css">
    <link rel="stylesheet" href="menu.css" type="text/css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="space.js" defer></script>
    <script type="text/javascript" src="spaceship.js"></script>
    <script type="text/javascript" src="enemeis.js"></script>
    <script type="text/javascript" src="menu.js"></script>
    
    
    <title>Chicken Invaders</title>
</head>
<body>
    <canvas id="space"></canvas>

    <div id="header">
        <div class="header-section">Logo</div>
        <div class="header-section">Chicken Invaders</div>
        <div class="header-section"></div>
        <button id="menu-toggle" type="button" onclick="menuToggle()" class="card toggle-bt">Main menu</button>
        <button id="sign-in" type="button" onclick="signInToggle()" class="card toggle-bt">Sign In</button>
        <button id="login" type="button" onclick="loginToggle()" class="card toggle-bt">Login</button>
    </div>

    <div id="login-screen">
        <h1 style="color:white; top: -55%; left: 35%;">Login</h1>
        <form id="login">
            <label id="login-msg"></label>
            <label>Username: </label>
            <input type="text" class="input-space" id="connect-username">
            <label>Password: </label>
            <input type="password" class="input-space" id="connect-password">
            <input type="button" style="position: relative; font-size: 20px;" class="card"  value="Connect" onclick="Connect()">
            <input type="button" style="position: relative; font-size: 20px;" class="card" value="Register"  onclick="signInToggle();loginToggle()">
        </form>
    </div>

    <div id="configure-fire" style="display: none;">
        <h1>Fire Key</h1>
        <input type="text" id="fire-input" style="min-height: 30px; text-align: center;" class="input-space" id="fireButton-input"  value="Space" >
        <h1>Round Time</h1>
        <select class="card" style="width:max-content; height: max-content;" id="timer-setup">
            <option>2:00</option>
            <option>2:30</option>
            <option>3:00</option>
            <option>3:30</option>
            <option>4:00</option>
            <option>4:30</option>
            <option>5:00</option>
        </select>
        <h1>Spaceship color</h1>
        <select class="card" style="width:max-content; height: max-content;" id="spaceship-color">
            <option style="background-color: orange;">Orange</option>
            <option style="background-color: blue;">Blue</option>
            <option style="background-color: green;;">Green</option>
            <option style="background-color: yellow;">Yellow</option>
            <option style="background-color: red;;">Red</option>
        </select>
        <input type="button" class="card" onclick="configure()" value="Apply selection" style="font-size:20px">
        
    </div>
    
    <div id="sign-in-screen" style="display: none;">
        <form id="sign-in">
            <label id="username-label">Username: </label>
            <input type="text" class="input-space" id="username-input">
            <label id="password1-label">Password:</label>
            <input type="password" class="input-space" id="password1-input">
            <label id="password2-label">Verify Password:</label>
            <input type="password" class="input-space" id="password2-input">
            <label id="first-name-label">First Name: </label>
            <input type="text" class="input-space" id="first-name-input">
            <label id="last-name-label">Last Name: </label>
            <input type="text" class="input-space" id="last-name-input">
            <label>Birthdate:</label>
            <input autocomplete="off" class="text" id="MoveInDate" name="MoveInDate" placeholder="DD-MM-YYYY" type="date" spellcheck="false">
            <input type="button" class="card" onclick="Register()" value="Register">
        </form>
    </div>


    <div id="main-menu" style="display: none;">
        <h1 id="title-ci">Chicken<br>&nbsp &nbsp &nbsp Invaders</h1>
        <div id="menu">
            <div class="card" id="start-game-bt" onclick="startGame()">Start Game</div>
            <div class="card" id="options-bt" onclick="configureToggle()">Options</div>
            <div class="card" id="about-bt" onclick="aboutToggle()">About</div>
        </div>
    </div>
        
    <div id="about-modal" class="modal" style="display: none;">
        <div id="about" class="modal-content">
            <span id="about-exit" onclick="aboutToggle()">X</span>
            <h1>About</h1>
            <p>
                Hello out name is Eden & Shelly<br>
                We've created this game for universty project<br>
                Developing In network enivroments.
            </p>
        </div>
    </div>

    <div id="game" style="display: none;">
        <div id="score">Score:</div>
        <div id="health">ðŸš€ðŸš€ðŸš€</div>
        <div id="timer"></div>
        <button id="play" onclick="pauseOrplay()" style="position:absolute; margin-top: -95vh; left: 50%;" class="card">Play</button>  
    </div>


</body>
<script>
    var intervalTimer;
    var intervalGameEvents;
    var intervalTimer;
    
    var roundTimer = 2*60*1000;
    var timerDisplay;

    var aboutModal;

    const accounts = [{username: "p",password: 'testuser'}];
    localStorage.setItem("Accounts", JSON.stringify(accounts));

    
    $(document).ready(function() {
        menuSpaceOn();
        timerDisplay = document.getElementById("timer");
        aboutModal = document.getElementById("about-modal");
    })

    window.onclick = (event) => {
        if(event.target == aboutModal){
            aboutToggle();
        }
    }

    function menuSpaceOn(){

        if(intervalTimer){
            clearInterval(intervalTimer)
        }
        intervalTimer = setInterval(() => {
            contextSpace.clearRect(0, 0, space.width, space.height);
            updateStarPosition();
        }, 1);
    }

    function setTimer(timeString){
        let timeValue = timeString.split('\:');
        let minutes = parseInt(timeValue[0]);
        let seconds = parseInt(timeValue[1]);
        console.log(timeValue);
        console.log(minutes);
        console.log(seconds)
        roundTimer = minutes*60*1000 + seconds*1000;
    }

    function menuSpaceOff(){
        clearInterval(intervalTimer);      
    }

    function startGame(){
        var game = document.getElementById("game");
        game.style.display = "block";
        menuSpaceOff();
        toggleMenu();
        pauseOrplay();
    }

    function toggleMenu(){
        var main_menu = document.getElementById("main-menu").style.display = "none";
        var signIn = document.getElementById("sign-in-screen").style.display = "none";
        var login = document.getElementById("login-screen").style.display = "none";
        var header = document.getElementById("header").style.display = "none";
    }
    

    function pauseOrplay(){
        const play = document.getElementById("play");
        setSpaceship();
        enemyBullet = {x: space.width / 2, y: space.height};



        if(!gameState){
            
            createStars(10);
            intervalTimer = setInterval(() => {
                contextSpace.clearRect(0, 0, space.width, space.height);
                updateStarPosition();
                updateBrigade();
                updateTrailPosition();
                updateFirePositions();
                updateEnemyFirePositions();
                updateSpaceshipPositions();
            }, 1);

            var increaseCount = 0;
            intervalGameEvents = setInterval(() => {
                increaseSpeed(1.07);
                increaseCount++;
                if(increaseCount === 4){
                    clearInterval(intervalGameEvents);
                }
            }, 4000);
            play.innerHTML = "Pause";

            var time = roundTimer;
            intervalTimer = setInterval(() => {
                var minutes = Math.floor(time / (1000*60)).toString().padStart(2, 0);
                var seconds = Math.floor((time % (60*1000)/ 1000)).toString().padStart(2, 0);

                timerDisplay.innerHTML = `${minutes}:${seconds}`;
                time = time - 1000;

                if( time == 0){
                    alert("Game Over");
                }
            }, 1000);

            gameState = true;

        }else{
            clearInterval(intervalTimer);
            clearInterval(intervalGameEvents)
            clearInterval(intervalTimer);

            play.innerHTML = "Play";
            gameState = false;
        }  
    }

    function reset(){
        // createBrigade();
        if(healthBar == 0){
            alert("You Lost");
            healthBar = 3;
            enemeis_killed = 0;
        }
        if(enemeis_killed == 20){
            alert("You Won");
            healthBar = 3;
            enemeis_killed = 0;
        }

        // score = 0;
        scoreTag.textContent = `Score: ${score}`;
        shoots = [];
        enemyShots = [];
        spaceship = {x: space.width / 2, y: space.height - spaceship_height*3}
        enemyBullet = {x: space.width / 2, y: space.height};
        healthTag.textContent = 'ðŸš€'.repeat(healthBar);
    }


</script>

</html>